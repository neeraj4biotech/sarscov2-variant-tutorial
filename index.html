<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SARS-CoV-2 Variant Calling Tutorial ‚Äî ICE-Cloud</title>

<!-- Prism.js Syntax Highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"/>

<style>
/* -------- Base Layout -------- */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    line-height: 1.6;
    background: #ffffff;
    transition: background 0.3s, color 0.3s;
}
#sidebar {
    width: 260px;
    background:#f4f4f4;
    height:100vh;
    position:fixed;
    overflow:auto;
    padding:20px;
    border-right:1px solid #ccc;
}
#content {
    margin-left:280px;
    padding:32px;
    max-width:900px;
}

/* -------- Headers -------- */
h2 {
    color:#0b63a5;
    margin-top:40px;
}

/* -------- Code Cards (CB-CARD) -------- */
.code-card {
    border:1px solid #d0d7e2;
    border-radius:8px;
    padding:0;
    margin:18px 0;
    background:#f9fbff;
}
.code-card-header {
    background:#e8f2ff;
    padding:10px 14px;
    border-bottom:1px solid #d0d7e2;
    font-weight:bold;
    color:#0b63a5;
}
pre {
    margin:0;
    padding:14px;
    background:#111827;
    color:#e5e7eb;
    border-radius:0 0 8px 8px;
    overflow:auto;
}
.copy-btn {
    float:right;
    margin-top:-6px;
    background:#0b63a5;
    color:white;
    padding:4px 10px;
    border-radius:6px;
    cursor:pointer;
    font-size:12px;
}

/* -------- Workflow Diagram -------- */
.workflow-diagram {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin:25px 0;
    padding:18px;
    border-radius:10px;
    background:#eef6ff;
    border:1px solid #c9defa;
}
.workflow-step {
    text-align:center;
    font-size:14px;
    color:#0b63a5;
    width:90px;
}
.workflow-step span {
    font-size:30px;
    display:block;
}

/* -------- Dark Mode -------- */
.dark-mode {
    background:#1d1f23;
    color:#e5e5e5;
}
.dark-mode #sidebar {
    background:#2a2c31;
    color:white;
    border-right:1px solid #444;
}
.dark-mode pre {
    background:#0a0a0a;
}
.dark-mode .code-card {
    background:#2f3238;
    border-color:#555;
}
.dark-mode .code-card-header {
    background:#3a3d45;
    border-color:#555;
}

/* -------- Icon Box (for later use) -------- */
.info-box {
    padding:12px 14px;
    border-left:4px solid #0b63a5;
    background:#e8f2ff;
    border-radius:4px;
    margin:14px 0;
}

/* Remove icon box for Introduction & Objective */
.no-box {
    border:none !important;
    background:none !important;
    padding:0 !important;
}
</style>

</head>
<body>
<!-- ===================== SIDEBAR ===================== -->
<div id="sidebar">
    <h3>Contents</h3>
    <ul>
        <li><a href="#intro">Introduction</a></li>
        <li><a href="#objective">Objective</a></li>
        <li><a href="#workflow">Workflow Diagram</a></li>

        <li><a href="#step1">Step 1 ‚Äî Data Preparation</a></li>
        <li><a href="#step2">Step 2 ‚Äî FastQC</a></li>
        <li><a href="#step3">Step 3 ‚Äî Trimming</a></li>
        <li><a href="#step4">Step 4 ‚Äî Alignment (BWA)</a></li>
        <li><a href="#step5">Step 5 ‚Äî BAM Processing</a></li>
        <li><a href="#step6">Step 6 ‚Äî Variant Calling</a></li>
        <li><a href="#step7">Step 7 ‚Äî Annotation</a></li>

        <li><a href="#docs">Tool Documentation</a></li>
    </ul>
</div>

<!-- ===================== MAIN CONTENT ===================== -->
<div id="content">

<!-- ===================== INTRODUCTION ===================== -->
<h2 id="intro">Introduction</h2>

<p>
Next-generation sequencing (NGS) technology has transformed research in disease surveillance 
and diagnostics. A major application has been in tracking emerging mutations in the
SARS-CoV-2 genome, which helps monitor viral evolution, transmissibility, vaccine
effectiveness, and informs public health decisions. The combination of reference genomes,
genome-specific primers, and standardized bioinformatics workflows has enabled rapid,
high-throughput genomic analysis during the COVID-19 pandemic. However, limited access to
bioinformatics resources and difficulties in authorized data sharing remain common hurdles.
ICE-cloud, developed by the HPC-Medical and Bioinformatics group at C-DAC Pune, addresses
these challenges by providing a unified platform for data storage, analysis, and sharing.
This tutorial demonstrates the execution of a SARS-CoV-2 variant calling pipeline on ICE-cloud.
</p>

<!-- ===================== OBJECTIVE ===================== -->
<h2 id="objective">Objective</h2>
<p class="no-box">
To perform reference-based mapping and variant calling of SARS-CoV-2 sequencing data on ICE-Cloud, including QC, trimming, alignment, variant calling, annotation, and interpretation.
</p>

<!-- ===================== WORKFLOW DIAGRAM ===================== -->
<h2 id="workflow">Workflow Diagram</h2>

<div class="workflow-diagram">
    <div class="workflow-step"><span>üì•</span> Download</div>
    <div class="workflow-step">‚ûú</div>
    <div class="workflow-step"><span>üîç</span> FastQC</div>
    <div class="workflow-step">‚ûú</div>
    <div class="workflow-step"><span>‚úÇÔ∏è</span> Trim</div>
    <div class="workflow-step">‚ûú</div>
    <div class="workflow-step"><span>üß¨</span> BWA</div>
    <div class="workflow-step">‚ûú</div>
    <div class="workflow-step"><span>üßπ</span> SAMtools</div>
    <div class="workflow-step">‚ûú</div>
    <div class="workflow-step"><span>üß™</span> BCFtools</div>
    <div class="workflow-step">‚ûú</div>
    <div class="workflow-step"><span>üß†</span> SnpEff</div>
</div>

<hr>

<!-- ===================== STEP 1 ===================== -->
<h2 id="step1">Step 1 ‚Äî Data Preparation</h2>

<div class="code-card">
    <div class="code-card-header">
        Start ICE Container ‚Üí sratoolkit
        <button class="copy-btn" onclick="copyText('cmd1')">Copy</button>
    </div>
<pre id="cmd1"><code class="language-bash">
prefetch SRR15571424
fasterq-dump SRR15571424 -S -e 2
gzip fastq/SRR15571424_1.fastq
gzip fastq/SRR15571424_2.fastq
</code></pre>
</div>

<!-- ===================== STEP 2 ===================== -->
<h2 id="step2">Step 2 ‚Äî FastQC</h2>

<div class="code-card">
    <div class="code-card-header">
        Run FastQC
        <button class="copy-btn" onclick="copyText('cmd2')">Copy</button>
    </div>
<pre id="cmd2"><code class="language-bash">
cp -r /drive/public/ICE_Workshop/AIC_CCMB/var_call_tutorial .
cd var_call_tutorial
fastqc --threads 5 SRR15571424_1.fastq.gz SRR15571424_2.fastq.gz
ls -lrth
</code></pre>
</div>

<!-- ===================== STEP 3 ===================== -->
<h2 id="step3">Step 3 ‚Äî Read Trimming</h2>

<div class="code-card">
    <div class="code-card-header">
        Run Trim Galore
        <button class="copy-btn" onclick="copyText('cmd3')">Copy</button>
    </div>
<pre id="cmd3"><code class="language-bash">
cd var_call_tutorial
trim_galore --fastqc --paired SRR15571424_1.fastq.gz SRR15571424_2.fastq.gz
ls -lrth
</code></pre>
</div>

<!-- ===================== STEP 4 ===================== -->
<h2 id="step4">Step 4 ‚Äî Reference Alignment (BWA)</h2>

<div class="code-card">
    <div class="code-card-header">
        Run BWA
        <button class="copy-btn" onclick="copyText('cmd4')">Copy</button>
    </div>
<pre id="cmd4"><code class="language-bash">
cd var_call_tutorial
bwa index MN908947.3.fna

bwa mem -t 2 -R "@RG\tID:SRR15571424\tSM:SRR15571424\tPL:illumina\tLB:lib1\tPU:unit1" \
    -V -M -o SRR15571424.sam MN908947.3.fna \
    SRR15571424_1_val_1.fq.gz SRR15571424_2_val_2.fq.gz

ls -lrth
</code></pre>
</div>

<!-- ===================== STEP 5 ===================== -->
<h2 id="step5">Step 5 ‚Äî BAM Processing (SAMtools)</h2>

<div class="code-card">
    <div class="code-card-header">
        SAM ‚Üí BAM ‚Üí Sort ‚Üí Index
        <button class="copy-btn" onclick="copyText('cmd5')">Copy</button>
    </div>
<pre id="cmd5"><code class="language-bash">
samtools view -S -b SRR15571424.sam -o SRR15571424.bam --threads 5
samtools sort SRR15571424.bam -o SRR15571424_sorted.bam --threads 5
samtools index SRR15571424_sorted.bam

samtools view -b -F 4 SRR15571424_sorted.bam > SRR15571424_mapped.bam
samtools view -b -f 4 SRR15571424_sorted.bam > SRR15571424_unmapped.bam

samtools flagstat SRR15571424_sorted.bam
ls -lrth
</code></pre>
</div>

<!-- ===================== STEP 6 ===================== -->
<h2 id="step6">Step 6 ‚Äî Variant Calling (BCFtools)</h2>

<div class="code-card">
    <div class="code-card-header">
        mpileup + call
        <button class="copy-btn" onclick="copyText('cmd6')">Copy</button>
    </div>
<pre id="cmd6"><code class="language-bash">
bcftools mpileup -f MN908947.3.fna -Ou --threads 5 \
    SRR15571424_sorted.bam -o SRR15571424.bcf

bcftools call -mv -Ov --ploidy 1 --threads 2 \
    SRR15571424.bcf -o SRR15571424.vcf

ls -lrth
</code></pre>
</div>

<!-- ===================== STEP 7 ===================== -->
<h2 id="step7">Step 7 ‚Äî Annotation (SnpEff)</h2>

<div class="code-card">
    <div class="code-card-header">
        SnpEff Annotation
        <button class="copy-btn" onclick="copyText('cmd7')">Copy</button>
    </div>
<pre id="cmd7"><code class="language-bash">
/snpEff/scripts/buildDbNcbi.sh MN908947.3

java -jar /snpEff/snpEff.jar ann -v MN908947.3 SRR15571424.vcf \
    -csvStats SRR15571424_stat.csv \
    -htmlStats SRR15571424_stat.html \
    > SRR15571424_ann.vcf

grep "missense_variant" SRR15571424_ann.vcf
grep "MODERATE" SRR15571424_ann.vcf
grep "LOW" SRR15571424_ann.vcf
</code></pre>
</div>

<!-- ===================== TOOL DOCUMENTATION ===================== -->
<h2 id="docs">Tool Documentation</h2>
<ul>
    <li><a href="https://github.com/ncbi/sra-tools" target="_blank">SRA Toolkit</a></li>
    <li><a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/" target="_blank">FastQC</a></li>
    <li><a href="https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/" target="_blank">Trim Galore</a></li>
    <li><a href="https://github.com/lh3/bwa" target="_blank">BWA</a></li>
    <li><a href="https://www.htslib.org/" target="_blank">SAMtools</a></li>
    <li><a href="https://samtools.github.io/bcftools/" target="_blank">BCFtools</a></li>
    <li><a href="https://pcingola.github.io/SnpEff/" target="_blank">SnpEff</a></li>
</ul>

<hr>
<p>End of Tutorial ‚Äî Created for ICE-Cloud users.</p>

</div><!-- end content -->
<!-- ===================== FLOATING SEARCH BOX ===================== -->
<div id="searchBox">
    <input type="text" id="searchInput" placeholder="Search tutorial..." />
</div>

<!-- ===================== DARK MODE TOGGLE ===================== -->
<button id="darkToggle" title="Toggle Dark Mode">üåô</button>

<style>
/* Floating Search */
#searchBox {
    position: fixed;
    top: 15px;
    right: 70px;
    z-index: 2000;
}
#searchInput {
    padding: 6px 12px;
    border: 1px solid #aaa;
    border-radius: 6px;
    font-size: 14px;
    width: 180px;
}

/* Dark Mode Button */
#darkToggle {
    position: fixed;
    top: 15px;
    right: 20px;
    z-index: 2200;
    background: #0b63a5;
    color: white;
    border: none;
    padding: 7px 10px;
    border-radius: 6px;
    cursor: pointer;
}

/* Dark Mode */
body.dark {
    background: #111827;
    color: #e5e7eb;
}
body.dark #sidebar {
    background: #1f2937;
    border-color: #374151;
}
body.dark pre {
    background: #000;
}
body.dark .code-card {
    background: #1f2937;
    border-color: #2563eb;
    color: white;
}
body.dark a { color: #60a5fa; }
</style>

<!-- ===================== INTERACTIVE JAVASCRIPT ===================== -->
<script>
// ====== Copy to Clipboard ======
function copyText(id) {
    const text = document.getElementById(id).innerText;
    navigator.clipboard.writeText(text);
    alert("Copied!");
}

// ====== Dark Mode Toggle (DM-LIGHT) ======
document.getElementById("darkToggle").addEventListener("click", () => {
    document.body.classList.toggle("dark");
});

// ====== Smooth Scrolling ======
document.querySelectorAll('#sidebar a').forEach(link => {
    link.addEventListener("click", function(e){
        e.preventDefault();
        document.querySelector(this.getAttribute("href")).scrollIntoView({
            behavior: "smooth"
        });
    });
});

// ====== Scroll Spy (Auto-highlight in sidebar) ======
window.addEventListener("scroll", () => {
    let scrollPos = window.scrollY + 140;
    document.querySelectorAll("h2[id]").forEach(sec => {
        let id = sec.getAttribute("id");
        let link = document.querySelector(`#sidebar a[href="#${id}"]`);
        if (!link) return;

        if (scrollPos >= sec.offsetTop && scrollPos < sec.offsetTop + sec.offsetHeight) {
            link.classList.add("active-section");
        } else {
            link.classList.remove("active-section");
        }
    });
});

// Highlight class
const style = document.createElement("style");
style.innerHTML = `
#sidebar a.active-section {
    font-weight: bold;
    color: #0b63a5;
    text-decoration: underline;
}
`;
document.head.appendChild(style);

// ====== Floating Search (highlight matching text) ======
document.getElementById("searchInput").addEventListener("input", function(){
    let q = this.value.toLowerCase();
    document.querySelectorAll("#content p, #content li, #content pre").forEach(el => {
        el.style.background = "";
        if(q.length > 2 && el.innerText.toLowerCase().includes(q)){
            el.style.background = "yellow";
        }
    });
});

// ====== Prism Syntax Highlighting ======
Prism.highlightAll();
</script>

</body>
</html>

